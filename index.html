<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Claves WERO</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .box {
      background-color: #222;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 20px #9b59b6;
    }
    .key {
      font-size: 1.2em;
      font-weight: bold;
      background-color: #333;
      padding: 15px;
      border-radius: 8px;
      word-break: break-word;
      margin: 20px 0;
      color: #9b59b6;
    }
    .timer {
      color: #ccc;
      margin-bottom: 20px;
    }
    .copy-btn {
      padding: 12px 24px;
      font-size: 1em;
      background-color: #9b59b6;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .copy-btn:hover {
      background-color: #7c3fa0;
    }
  </style>
</head>
<body>
  <div class="box">
    <h1>¡Tu Clave WERO!</h1>
    <div class="key" id="keyBox">Cargando...</div>
    <div class="timer" id="timer">Tiempo restante: calculando...</div>
    <button class="copy-btn" onclick="copyKey()">Copiar Clave</button>
  </div>

  <script>
    // 1. Obtener clave desde key.txt
    async function fetchKey() {
      try {
        const response = await fetch('key.txt?t=' + Date.now());
        return (await response.text()).trim();
      } catch {
        return "WERO-A9D4Q1C7MBEX"; // Clave por defecto
      }
    }

    // 2. Calcular tiempo restante (72 horas desde última modificación)
    async function getKeyData() {
      const key = await fetchKey();
      const nextRotation = new Date();
      nextRotation.setHours(nextRotation.getHours() + 72);
      return { key, nextRotation };
    }

    // 3. Formatear tiempo
    function formatTime(endTime) {
      const now = new Date();
      const ms = endTime - now;
      const days = Math.floor(ms / (1000 * 60 * 60 * 24));
      const hours = Math.floor((ms % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      return `${days}d ${hours}h`;
    }

    // 4. Actualizar la UI
    async function updateUI() {
      const { key, nextRotation } = await getKeyData();
      document.getElementById("keyBox").textContent = key;
      document.getElementById("timer").textContent = 
        `Próxima rotación: ${formatTime(nextRotation)}`;
    }

    // 5. Copiar al portapapeles
    function copyKey() {
      navigator.clipboard.writeText(document.getElementById("keyBox").textContent)
        .then(() => alert("¡Clave copiada!"));
    }

    // Iniciar
    updateUI();
    setInterval(updateUI, 3600000); // Actualizar cada hora
  </script>
</body>
</html>
